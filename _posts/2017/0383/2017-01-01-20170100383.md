---
layout: post
title:  "数据库优化:优化查询 » java面试题"
title2:  "数据库优化优化查询 » java面试题"
date:   2017-01-01 23:41:23  +0800
source:  "https://www.jfox.info/shu-ju-ku-you-hua-you-hua-cha-xun.html"
fileName:  "0383"
lang:  "zh_CN"
published: true
permalink: "2017/shu-ju-ku-you-hua-you-hua-cha-xun.html"
---



### 数据库优化的目标无非是避免磁盘I/O瓶颈、减少CPU利用率和减少资源竞争。

查询优化规则：在访问数据库表的数据(Access Data)时，要尽可能避免排序（Sort）、连接(Join)和相关子查询*作。经验告诉我们，在优化查询时，必须做到： 
① 尽可能少的行； 
② 避免排序或为尽可能少的行排序，若要做大量数据排序，最好将相关数据放在临时表中*作；用简单的键（列）排序，如整型或短字符串排序； 
③ 避免表内的相关子查询； 
④ 避免在Where子句中使用复杂的表达式或非起始的子字符串、用长字符串连接； 
⑤ 在Where子句中多使用“与”（And）连接，少使用“或”(Or)连接； 
⑥ 利用临时数据库。在查询多表、有多个连接、查询复杂、数据要过滤时，可以建临时表（索引）以减少I/O。但缺点是增加了空间开销。 
除非每个列都有索引支持，否则在有连接的查询时分别找出两个动态索引，放在工作表中重新排序。

分割表或储存冗余数据 
分割表分为水平分割表和垂直分割表两种。分割表增加了维护数据完整性的代价。 
水平分割表：一种是当多个过程频繁访问数据表的不同行时，水平分割表，并消除新表中的冗余数据列；若个别过程要访问整个数据，则要用连接*作，这也无妨分 割表；典型案例是电信话单按月分割存放。另一种是当主要过程要重复访问部分行时，最好将被重复访问的这些行单独形成子集表（冗余储存），这在不考虑磁盘空 间开销时显得十分重要；但在分割表以后，增加了维护难度，要用触发器立即更新、或存储过程或应用代码批量更新，这也会增加额外的磁盘I/O开销。 
垂直分割表（不破坏第三范式），一种是当多个过程频繁访问表的不同列时，可将表垂直分成几个表，减少磁盘I/O（每行的数据列少，每页存的数据行就多，相 应占用的页就少），更新时不必考虑锁，没有冗余数据。缺点是要在插入或删除数据时要考虑数据的完整性，用存储过程维护。另一种是当主要过程反复访问部分列 时，最好将这部分被频繁访问的列数据单独存为一个子集表（冗余储存），这在不考虑磁盘空间开销时显得十分重要；但这增加了重叠列的维护难度，要用触发器立 即更新、或存储过程或应用代码批量更新，这也会增加额外的磁盘I/O开销。垂直分割表可以达到最大化利用Cache的目的。 
总之，为主要过程分割表的方法适用于：各个过程需要表的不联结的子集，各个过程需要表的子集，访问频率高的主要过程不需要整表。在主要的、频繁访问的主表需要表的子集而其它主要频繁访问的过程需要整表时则产生冗余子集表。 
注意，在分割表以后，要考虑重新建立索引。
